<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASR Hub - 協議測試中心</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind CSS 配置 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out'
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Dark Mode Styles -->
    <link rel="stylesheet" href="../common/dark-mode-styles.css">
    
    <!-- Custom animations and styles -->
    <style>
        @keyframes recording {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .recording {
            animation: recording 1.5s infinite;
        }
        
        #results:empty::before {
            content: attr(data-placeholder);
            color: #9ca3af;
        }
        
        .dark #results:empty::before {
            color: #6b7280;
        }
        
        .dark button:disabled {
            opacity: 0.5;
        }
        
        .dark audio {
            filter: invert(0.8);
        }
        
        #fileInfo.has-file {
            color: #059669;
            font-weight: 500;
        }
        
        .dark #fileInfo.has-file {
            color: #10b981;
        }
        
        #results.has-content {
            color: #1f2937;
        }
        
        .dark #results.has-content {
            color: #f3f4f6;
        }
        
        /* Dynamic status colors using data attributes */
        .status-dynamic[data-status="ready"] {
            color: #4b5563 !important;
        }
        .dark .status-dynamic[data-status="ready"] {
            color: #9ca3af !important;
        }
        
        .status-dynamic[data-status="recording"] {
            color: #dc2626 !important;
        }
        .dark .status-dynamic[data-status="recording"] {
            color: #f87171 !important;
        }
        
        .status-dynamic[data-status="processing"] {
            color: #2563eb !important;
        }
        .dark .status-dynamic[data-status="processing"] {
            color: #60a5fa !important;
        }
        
        .status-dynamic[data-status="complete"] {
            color: #16a34a !important;
        }
        .dark .status-dynamic[data-status="complete"] {
            color: #4ade80 !important;
        }
        
        .status-dynamic[data-status="error"] {
            color: #dc2626 !important;
        }
        .dark .status-dynamic[data-status="error"] {
            color: #f87171 !important;
        }
        
        .status-dynamic[data-status="uploading"] {
            color: #ea580c !important;
        }
        .dark .status-dynamic[data-status="uploading"] {
            color: #fb923c !important;
        }
        
        .status-dynamic[data-status="connecting"] {
            color: #6b7280 !important;
        }
        .dark .status-dynamic[data-status="connecting"] {
            color: #9ca3af !important;
        }
        
        /* Event flow visualization */
        .event-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .event-flow .event {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            white-space: nowrap;
        }
        
        .event-flow .arrow {
            font-size: 18px;
        }
        
        .dark .event-flow {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <a href="../" class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-semibold mb-6 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i> 返回測試中心
        </a>
        
        <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-4">ASR Hub 協議測試中心</h1>
        
        <!-- Event Flow Visualization -->
        <div class="event-flow">
            <span class="event">upload_file</span>
            <span class="arrow">→</span>
            <span class="event">upload_file_done</span>
            <span class="arrow">→</span>
            <span class="event">transcription_done</span>
        </div>
        
        <!-- Architecture Info -->
        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                <div class="text-sm text-blue-800 dark:text-blue-200">
                    <strong>純事件驅動架構</strong><br>
                    此版本使用 PyStoreX 事件驅動架構，所有操作都通過 action 分發，由 SessionEffects 自動處理業務邏輯。
                </div>
            </div>
        </div>
        
        <!-- Protocol Selector -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="protocol" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">選擇通訊協議：</label>
                    <select id="protocol" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                        <option value="websocket">WebSocket (事件驅動)</option>
                        <option value="socketio">Socket.io (事件驅動)</option>
                        <option value="http_sse">HTTP SSE (事件驅動)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">辨識模式：</label>
                    <div class="flex items-center">
                        <input type="checkbox" id="autoTranscribe" class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="autoTranscribe" class="text-sm text-gray-700 dark:text-gray-300">錄音結束後自動開始辨識</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="flex flex-wrap gap-4 justify-center mb-8">
            <button id="startRecord" class="px-8 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition-colors flex items-center">
                <i class="fas fa-microphone mr-2"></i> 開始錄音
            </button>
            <button id="stopRecord" class="px-8 py-3 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg transition-colors flex items-center" disabled>
                <i class="fas fa-stop mr-2"></i> 結束錄音
            </button>
            <button id="startRecognition" class="px-8 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg transition-colors flex items-center" disabled>
                <i class="fas fa-brain mr-2"></i> 開始辨識
            </button>
        </div>
        
        <!-- Upload Section -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center mb-6">
            <div class="text-gray-400 dark:text-gray-500 font-medium mb-4">或</div>
            <label for="audioFile" class="inline-flex items-center px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg cursor-pointer transition-colors">
                <i class="fas fa-upload mr-2"></i>
                <span>選擇音訊檔案</span>
                <input type="file" id="audioFile" accept="audio/*,.mp3,.wav,.m4a,.webm,.ogg,.mp4" class="hidden" />
            </label>
            <div id="fileInfo" class="mt-4 text-gray-600 dark:text-gray-400"></div>
        </div>

        <!-- Status Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                <i class="fas fa-info-circle text-blue-500 mr-2"></i>狀態
            </h3>
            <div id="status" class="text-lg text-gray-600 dark:text-gray-400 mb-2 status-dynamic" data-status="ready">準備就緒</div>
            <div id="connectionStatus" class="inline-flex items-center px-3 py-1 rounded-full text-sm text-gray-600 dark:text-gray-400">
                <i class="fas fa-circle text-red-500 mr-2"></i>未連接
            </div>
        </div>

        <!-- Audio Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                <i class="fas fa-music text-purple-500 mr-2"></i>錄音預覽
            </h3>
            <audio id="audioPlayer" controls class="w-full" style="display: none;"></audio>
            <div id="audioInfo" class="text-gray-600 dark:text-gray-400"></div>
        </div>

        <!-- Results Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                <i class="fas fa-comment-dots text-green-500 mr-2"></i>辨識結果
            </h3>
            <div id="results" class="min-h-[100px] p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-700 dark:text-gray-300" data-placeholder="辨識結果將顯示在這裡..."></div>
        </div>

        <!-- Logs Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                <i class="fas fa-terminal text-gray-600 dark:text-gray-400 mr-2"></i>事件日誌
            </h3>
            <div id="logs" class="h-48 overflow-y-auto p-3 bg-gray-100 dark:bg-gray-900 rounded-lg text-sm font-mono text-gray-800 dark:text-gray-200"></div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="../common/theme.js"></script>
    <script src="../common/common.js"></script>
    <script src="modules/audio-recorder.js"></script>
    <script src="modules/audio-uploader.js"></script>
    <script src="modules/ui-manager.js"></script>
    <script src="modules/protocol-adapters.js"></script>
    <script src="app.js"></script>
</body>
</html>